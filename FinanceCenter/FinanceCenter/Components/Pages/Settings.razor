@page "/settings"

<PageTitle>設定</PageTitle>

<MudText Typo="Typo.h4" Class="mb-4">設定</MudText>

<MudGrid>
    @* 左側導航 *@
    <MudItem xs="12" sm="3" md="2">
        <MudNavMenu>
            <MudNavLink Icon="@Icons.Material.Filled.Business"
                        OnClick="@(() => SelectTab(0))"
                        Match="NavLinkMatch.All"
                        Class="@(SelectedTab == 0 ? "mud-nav-link-active" : "")">
                部門管理
            </MudNavLink>
            <MudNavLink Icon="@Icons.Material.Filled.AccountBalance"
                        OnClick="@(() => SelectTab(1))"
                        Match="NavLinkMatch.All"
                        Class="@(SelectedTab == 1 ? "mud-nav-link-active" : "")">
                銀行設定
            </MudNavLink>
        </MudNavMenu>
    </MudItem>

    @* 右側內容區 *@
    <MudItem xs="12" sm="9" md="10">
        @switch (SelectedTab)
        {
            case 0:
                @* 部門管理 *@
                <MudPaper Class="pa-4">
                    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-3">
                        <MudText Typo="Typo.h6">部門管理</MudText>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="OpenAddDepartmentDialogAsync">新增</MudButton>
                    </MudStack>

                    <MudTable Items="@Departments" Hover="true" Dense="true">
                        <HeaderContent>
                            <MudTh>代號</MudTh>
                            <MudTh>名稱</MudTh>
                            <MudTh>狀態</MudTh>
                            <MudTh>排序</MudTh>
                            <MudTh Style="width: 120px">操作</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="代號">@context.Code</MudTd>
                            <MudTd DataLabel="名稱">@context.Name</MudTd>
                            <MudTd DataLabel="狀態">
                                <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                    @(context.IsActive ? "啟用" : "停用")
                                </MudChip>
                            </MudTd>
                            <MudTd DataLabel="排序">@context.SortOrder</MudTd>
                            <MudTd DataLabel="操作">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" OnClick="@(() => OpenEditDepartmentDialogAsync(context))" />
                            </MudTd>
                        </RowTemplate>
                        <NoRecordsContent>
                            <MudText>尚無部門資料</MudText>
                        </NoRecordsContent>
                    </MudTable>
                </MudPaper>
                break;

            case 1:
                @* 銀行初始金額 *@
                <MudPaper Class="pa-4">
                    <MudText Typo="Typo.h6" Class="mb-3">銀行初始金額</MudText>

                    <MudTable Items="@BankBalances" Hover="true" Dense="true">
                        <HeaderContent>
                            <MudTh>銀行</MudTh>
                            <MudTh>初始金額</MudTh>
                            <MudTh>生效年份</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="銀行">@GetBankDisplayName(context.BankType)</MudTd>
                            <MudTd DataLabel="初始金額">
                                <MudNumericField T="decimal" @bind-Value="context.InitialBalance" Format="N0" Variant="Variant.Outlined" Margin="Margin.Dense" HideSpinButtons="true" />
                            </MudTd>
                            <MudTd DataLabel="生效年份">
                                <MudNumericField T="int" @bind-Value="context.EffectiveYear" Variant="Variant.Outlined" Margin="Margin.Dense" HideSpinButtons="true" Min="2000" Max="2100" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>

                    <MudStack Row="true" Justify="Justify.FlexEnd" Class="mt-3">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveBankBalancesAsync">儲存</MudButton>
                    </MudStack>
                </MudPaper>
                break;
        }
    </MudItem>
</MudGrid>
